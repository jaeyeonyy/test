#include <stdio.h>
#include <stdlib.h>
#include <dirent.h>   
#include <sys/stat.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>

void print_directory(const char *path, int is_detail) {
    DIR *dir = opendir(path);
    if (dir == NULL) {
        perror("opendir");
        return;
    }

    struct dirent *dent;
    while ((dent = readdir(dir))) {
        // is_detail이 0일 때는 .과 .. 출력 안 함
        if (!is_detail &&
            (strcmp(dent->d_name, ".") == 0 || strcmp(dent->d_name, "..") == 0)) {
            continue;
        }

        if (is_detail) {
            // 상세 정보 출력: \t로 구분
            printf("%lu\t%ld\t%u\t%u\t%s\n",
                   (unsigned long)dent->d_ino,
                   (long)dent->d_off,
                   (unsigned int)dent->d_reclen,
                   (unsigned int)dent->d_type,
                   dent->d_name);
        } else {
            // 단순 이름만 출력
            printf("%s\n", dent->d_name);
        }
    }

    closedir(dir);
}

void print_recursive_directory(const char *path, int is_detail) {
    DIR *dir = opendir(path);
    if (dir == NULL) {
        perror("opendir");
        return;
    }

    struct dirent *dent;
    while ((dent = readdir(dir))) {
        // .과 ..은 무시
        if (strcmp(dent->d_name, ".") == 0 || strcmp(dent->d_name, "..") == 0) {
            continue;
        }

        // 전체 경로 구성
        char full_path[1024];
        strcpy(full_path, path);
        strcat(full_path, "/");
        strcat(full_path, dent->d_name);

        // 디렉토리일 경우만 재귀적으로 들어감
        if (dent->d_type == DT_DIR) {
            printf("%s -> %s\n", path, full_path);
            print_directory(full_path, is_detail);
            print_recursive_directory(full_path, is_detail);
        }
    }

    closedir(dir);
}

int main(int argc, char *argv[]) {
    if (argc == 1) {
        // 인자가 없으면 현재 디렉토리의 목록을 단순하게 출력
        print_directory(".",0);
    } else if (argc == 2) {
        if (strcmp(argv[1], "-l") == 0) {
            print_directory(".",1);
        } else if (strcmp(argv[1], "-r") == 0) {
            print_recursive_directory(".",0);
        } else {
            // 인자가 디렉토리 이름인 경우
            print_directory(argv[1],0);
        }
    } else if (argc == 3) {
        if (strcmp(argv[1], "-l") == 0) {
            print_directory(argv[2],1);
        } else if (strcmp(argv[1], "-r") == 0) {
            print_recursive_directory(argv[2],0);
        } else {
            printf("can't use %s\n", argv[1]);
        }
    } else {
        printf("can't use %s\n", argv[1]);
    }
    return 0;
}
